var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(e===void 0){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var PScroll=function(a){"use strict";function b(a){var b=[];return q.set(a,b),b}function c(a){q.delete(a)}function d(a){var c=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return q.get(a)||(c?b(a):null)}function e(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=q.get(a);if(!e)return[];var f,g=[],h=!0,i=!1;try{for(var j,k,l=e[Symbol.iterator]();!(h=(j=l.next()).done);h=!0)k=j.value,k.match(b,c,d)&&g.push(k)}catch(a){i=!0,f=a}finally{try{!h&&l.return&&l.return()}finally{if(i)throw f}}return g}function f(a,b,c){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;if(o(a)){var g,h=!0,i=!1;try{for(var j,k,l=a[Symbol.iterator]();!(h=(j=l.next()).done);h=!0)k=j.value,f(k,b,c,e)}catch(a){i=!0,g=a}finally{try{!h&&l.return&&l.return()}finally{if(i)throw g}}return a}if(p(b)){var m,n=!0,q=!1;try{for(var r,s,u=b.split(/\s/)[Symbol.iterator]();!(n=(r=u.next()).done);n=!0)s=r.value,f(a,s,c,e)}catch(a){q=!0,m=a}finally{try{!n&&u.return&&u.return()}finally{if(q)throw m}}return a}new t(d(a,!0),b,c,e);return a}function g(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return d.max=1,f(a,b,c,d)}function h(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(o(a)){var f,g=!0,i=!1;try{for(var j,k,l=a[Symbol.iterator]();!(g=(j=l.next()).done);g=!0)k=j.value,h(k,b,c)}catch(a){i=!0,f=a}finally{try{!g&&l.return&&l.return()}finally{if(i)throw f}}return a}if(p(b)){var m,n=!0,q=!1;try{for(var r,s,t=b.split(/\s/)[Symbol.iterator]();!(n=(r=t.next()).done);n=!0)s=r.value,h(a,b,c)}catch(a){q=!0,m=a}finally{try{!n&&t.return&&t.return()}finally{if(q)throw m}}return a}var u,v=!0,w=!1;try{for(var x,y,z=e(a,b,c,d)[Symbol.iterator]();!(v=(x=z.next()).done);v=!0)y=x.value,y.kill()}catch(a){w=!0,u=a}finally{try{!v&&z.return&&z.return()}finally{if(w)throw u}}return a}function i(a){var b=q.get(a);if(!b)return a;for(;b.length;)b.pop().kill();return c(a),a}function j(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!a)return null;if(o(a)){var d,f=!0,g=!1;try{for(var h,i,k=a[Symbol.iterator]();!(f=(h=k.next()).done);f=!0)i=h.value,j(i,b,c)}catch(a){g=!0,d=a}finally{try{!f&&k.return&&k.return()}finally{if(g)throw d}}return a}if("string"==typeof b){if(p(b)){var l,m=!0,n=!1;try{for(var q,r,t=b.split(/\s/)[Symbol.iterator]();!(m=(q=t.next()).done);m=!0)r=q.value,j(a,r,c)}catch(a){n=!0,l=a}finally{try{!m&&t.return&&t.return()}finally{if(n)throw l}}return a}return j(a,new s(a,b,c))}b.currentTarget=a;var u,v=e(a,b.type).sort(function(a,b){return b.priority-a.priority}),w=!0,x=!1;try{for(var y,z,A=v[Symbol.iterator]();!(w=(y=A.next()).done)&&(z=y.value,z.call(b),!b.canceled);w=!0);}catch(a){x=!0,u=a}finally{try{!w&&A.return&&A.return()}finally{if(x)throw u}}return b.propagateTo&&j(b.propagateTo(b.currentTarget),b),a}function k(){requestAnimationFrame(k);var a,b=!0,c=!1;try{for(var d,e,f=C[Symbol.iterator]();!(b=(d=f.next()).done);b=!0)e=d.value,e.update()}catch(b){c=!0,a=b}finally{try{!b&&f.return&&f.return()}finally{if(c)throw a}}}function l(a,b){b.preventDefault();var c=a.vars.wheelX,d=a.vars.wheelY,e=a.vars.wheelSpeedX,f=a.vars.wheelSpeedY,g=0===b.deltaMode?1:16,h=b.deltaX*g,i=b.deltaY*g;if(!a.mouseWheelID)c.reset(h),d.reset(i),e.reset(0),f.reset(0),a.dispatchEvent("wheel-start"),a.mouseWheelID=setTimeout(function(){return m(a)},E);else{c.newValue(h),d.newValue(i),e.newValue(c.average.value),f.newValue(d.average.value);var j;1<e.growth.value&&a.dispatchEvent("wheel-increase-speed-x"),1<f.growth.value&&a.dispatchEvent("wheel-increase-speed-y",{speed:f.value}),(j=e.growth.through(1))&&a.dispatchEvent(-1===j?"wheel-max-speed-x":"wheel-min-speed-x"),(j=f.growth.through(1))&&a.dispatchEvent(-1===j?"wheel-max-speed-y":"wheel-min-speed-y"),clearTimeout(a.mouseWheelID),a.mouseWheelID=setTimeout(function(){return m(a)},E)}}function m(a){a.mouseWheelID=null,a.dispatchEvent("wheel-stop")}function n(a,b){for(var c in"svg"===a&&(a=document.createElementNS(G,"svg"),a.setAttributeNS(G,"width",300),a.setAttributeNS(G,"height",300)),"string"==typeof a&&(a=document.createElementNS(G,a)),b&&b.parent&&(b.parent.appendChild(a),delete b.parent),b)a.setAttributeNS(null,c,b[c]);return a}var o=function(a){return!!a&&"function"==typeof a[Symbol.iterator]},p=function(a){return"string"==typeof a&&/\s/.test(a)},q=new WeakMap,r={cancelable:!0,priority:0,propagateTo:null},s=function(){function a(b,c,d){for(var e in _classCallCheck(this,a),d=Object.assign({},r,d),Object.defineProperty(this,"target",{value:b}),Object.defineProperty(this,"currentTarget",{writable:!0,value:b}),Object.defineProperty(this,"type",{value:c}),d)Object.defineProperty(this,e,{enumerable:e in r,value:d[e]});Object.defineProperty(this,"canceled",{writable:this.cancelable,value:!1})}return _createClass(a,[{key:"cancel",value:function(){this.cancelable&&(this.canceled=!0)}}]),a}(),t=function(){function a(b,c,d){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;_classCallCheck(this,a),this.count=0,this.array=b,this.array.push(this),this.enabled=!0,this.priority=0,Object.assign(this,e),this.type=c,this.callback=d}return _createClass(a,[{key:"match",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(null!==c&&this.match(a,b)){for(var d in c)if(this[d]!==c[d])return!1;return!0}return null===b?this.type instanceof RegExp?this.type.test(a):this.type instanceof Array?-1!==this.type.indexOf(a):"function"==typeof this.type?this.type(a):this.type===a:this.match(a)&&this.callback===b}},{key:"call",value:function(a){var b;(b=this.callback).call.apply(b,[this.thisArg||a.currentTarget,a].concat(_toConsumableArray(this.args||[]))),this.count++,this.count===this.max&&this.kill()}},{key:"kill",value:function(){var a=this.array.indexOf(this);this.array.splice(a,1),delete this.array,delete this.type,delete this.callback,delete this.options}}]),a}(),u=function a(){_classCallCheck(this,a)};Object.assign(u.prototype,{getAllListeners:function(){var a=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return d(this,a)},clearEventListener:function(){return i(this)},addEventListener:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return f(this,a,b,c)},on:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return f(this,a,b,c)},once:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return g(this,a,b,c)},removeEventListener:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return h(this,a,b,c)},off:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return h(this,a,b,c)},dispatchEvent:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return j(this,a,b)}});var v=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,a),this.value_old=b,this.value=b}return _createClass(a,[{key:"reset",value:function(a){this.value_old=this.value=a}},{key:"newValue",value:function(a){this.value_old=this.value,this.value=a}},{key:"newValueIncrement",value:function(a){this.value_old=this.value,this.value+=a}},{key:"through",value:function(a){var b=this.value-a,c=this.value_old-a;return 0<=b&&0>c?1:0>=b&&0<c?-1:0}}]),a}(),w=function(a){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10;_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return e.variableLength=d,e.index=0,e.values=[],e.sum=new v,e.average=new v,e.growth=new v,e.reset(a),c&&(e.derivative=new b(0,c-1,d)),e}return _inherits(b,a),_createClass(b,[{key:"getValues",value:function(){return this.values.slice(this.index).concat(this.values.slice(0,this.index))}},{key:"reset",value:function(a){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"reset",this).call(this,a),this.index=0,this.sum.reset(a*this.variableLength),this.average.reset(a),this.growth.reset(1);for(var c=0;c<this.variableLength;c++)this.values[c]=a;return this}},{key:"newValue",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"newValue",this).call(this,a),this.sum.newValueIncrement(-this.values[this.index]+this.value),this.average.newValue(this.sum.value/this.variableLength),this.growth.newValue(this.value/this.value_old),this.values[this.index]=a,this.index=(this.index+1)%this.variableLength,this.derivative&&this.derivative.newValue(this.value-this.value_old),this}}]),b}(v),x=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"trigger",value:function(a){this.dispatchEvent(a)}},{key:"update",value:function(a,b){var c=this.state_old=this.state;this.state=a,this.local_old=this.local,this.local=b,a!==c&&(0===a&&0!==c&&this.trigger("enter"),0!==a&&0===c&&this.trigger("exit"),0!==a&&0!==c&&(this.trigger("touch"),this.trigger("leave")))}}]),b}(u),y={bound:"bound",trigger:"trigger"},z=0,A=function(a){function b(a,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"bound",e=arguments[3];_classCallCheck(this,b);var f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return f.scroll=a,f.position=c,f.type=d,f.margin=e,f.name=name||"stop-"+z,z++,f}return _inherits(b,a),_createClass(b,null,[{key:"Type",get:function(){return y}}]),_createClass(b,[{key:"set",value:function(a){for(var b in a)this[b]=a[b];return this}},{key:"update",value:function(a){var c=a-this.position,d=c<-this.margin?-1:c>this.margin?1:0;_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"update",this).call(this,d,c)}},{key:"remove",value:function(){if(!this.scroll)return this;var a=this.scroll.stops.indexOf(this);return scroll.stops.splice(a,1),this}},{key:"toInterval",value:function(a){var b=a.offset,c=a.type,d=void 0===c?null:c;return this.scroll.createInterval({position:this.position-b,width:2*b,type:d})}}]),b}(x),B=function(a){function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return e.scroll=a,e.stopA=c,e.stopB=d,e}return _inherits(b,a),_createClass(b,[{key:"update",value:function(a){var c=(a-this.stopA.position)/(this.stopB.position-this.stopA.position);c=0>c?0:1<c?1:c;var d=0>c?-1:1<c?1:0;_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"update",this).call(this,d,c),(0<=this.local&&1>=this.local||0<=this.local_old&&1>=this.local_old)&&this.dispatchEvent("update")}},{key:"remove",value:function(){if(!this.scroll)return this;var a=this.scroll.intervals.indexOf(this);return scroll.intervals.splice(a,1),this.stopA.remove(),this.stopB.remove(),this}}]),b}(x),C=[],D=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.id="scroll-"+(C.push(a)-1),a._position=0,a._position_new=0,a._position_old=0,a._velocity=0,a._velocity_new=0,a._velocity_old=0,a.friction=1e-3,a.stops=[],a.intervals=[],a.epsilon=1e-3,a.createStop({position:0}),a}var c=Math.abs;return _inherits(b,a),_createClass(b,[{key:"update",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1/60;if(this._position_old=this._position_new,this._velocity_old=this._velocity_new,this._velocity_new*=Math.pow(this.friction,a),this._position_new+=(this._velocity_new+this._velocity_old)/2*a,c(this._position-this._position_new)<this.epsilon)return this;this._position=this._position_new,this._velocity=this._velocity_new;var b,d=!0,e=!1;try{for(var f,g,h=this.stops[Symbol.iterator]();!(d=(f=h.next()).done);d=!0)g=f.value,g.update(this._position,this._position_old)}catch(a){e=!0,b=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw b}}var i,j=!0,k=!1;try{for(var l,m,n=this.intervals[Symbol.iterator]();!(j=(l=n.next()).done);j=!0)m=l.value,m.update(this._position,this.position_old)}catch(a){k=!0,i=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw i}}return this.dispatchEvent("update"),this}},{key:"stopByIndex",value:function(a){return this.stops[0>a?this.stops.length+a:a]}},{key:"stopByName",value:function(a){var b,c=!0,d=!1;try{for(var e,f,g=this.stops[Symbol.iterator]();!(c=(e=g.next()).done);c=!0)if(f=e.value,f.name===a)return f}catch(a){d=!0,b=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw b}}return null}},{key:"getStop",value:function(a){var b,d=a.position,e=a.type,f=void 0===e?null:e,g=a.tolerance,h=void 0===g?1e-9:g,i=!0,j=!1;try{for(var k,l,m=this.stops[Symbol.iterator]();!(i=(k=m.next()).done);i=!0)if(l=k.value,(null===f||f===l.type)&&c(l.position-d)<h)return l}catch(a){j=!0,b=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw b}}return null}},{key:"nearestStop",value:function(a){var b,e=a.position,f=a.type,g=void 0===f?null:f,h={d:Infinity,stop:null},i=!0,j=!1;try{for(var k,l,m=this.stops[Symbol.iterator]();!(i=(k=m.next()).done);i=!0)if(l=k.value,null===g||g===l.type){var n=c(e-l.position);n<h.d&&(h.d=n,h.stop=l)}}catch(a){j=!0,b=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw b}}return h.stop}},{key:"createStop",value:function(a){var b=a.position,c=a.type,d=void 0===c?"bound":c,e=a.margin,f=void 0===e?.1:e,g=a.name,h=void 0===g?null:g,j=new A(this,b,d,f,h),k=0,i=this.stops.length;for(k;k<i&&!(this.stops[k].position>j.position);k++);return this.stops.splice(k,0,j),j}},{key:"createInterval",value:function(a){var b,c,d=a.position,e=a.width,f=a.type,g=void 0===f?"trigger":f;b=this.createStop({position:d,type:g}),c=this.createStop({position:d+e,type:g});var h=new B(this,b,c);return this.intervals.push(h),h}},{key:"shoot",value:function(){var a=Math.log,b=this.position-this.velocity/a(this.friction),c=this.nearestStop({position:b,type:y.bound});this.velocity=(this.position-c.position)*a(this.friction)}},{key:"interval",value:function(a){var b=a.from,c=a.to,d=a.position,e=a.width;isNaN(b)||isNaN(c)||this.createInterval()}},{key:"stop",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:y.bound;"string"==typeof a&&"+="===a.slice(0,2)&&(a=(this.stops.length?this.stops[this.stops.length-1].position:0)+parseFloat(a.slice(2)));var c=this.getStop({position:a,type:b})||this.createStop({position:a,type:b});return c}},{key:"trigger",value:function(a){return this.stop(a,A.Type.trigger)}},{key:"position",get:function(){return this._position},set:function(a){this._position_new=a}},{key:"velocity",get:function(){return this._velocity},set:function(a){this._velocity_new=a}}]),b}(u);k();var E=120,F=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return"string"==typeof a&&(a=document.querySelector(a)),c.vars={wheelX:new w(0,0,10),wheelY:new w(0,0,10),wheelSpeedX:new w(0,2,10),wheelSpeedY:new w(0,2,10)},a.addEventListener("mousewheel",function(a){return l(c,a)}),c}return _inherits(b,a),b}(u),G="http://www.w3.org/2000/svg",H={position:"absolute",top:0,left:0,width:"100%"},I=function(){function a(b){for(var c in _classCallCheck(this,a),this.options=Object.assign({scale:1},b),this.svg=n("svg"),H)this.svg.style.setProperty(c,H[c]);this.g=n("g",{parent:this.svg,fill:"none",stroke:"red",transform:"translate(20, 20)"}),this.options.scroll&&this.init(this.options.scroll)}return _createClass(a,[{key:"init",value:function(a){var b=this;this.scroll=a;var c=this.options.scale;this.line=n("line",{parent:this.g,x1:this.scroll.stopByIndex(0).position*c,x2:this.scroll.stopByIndex(-1).position*c,y1:0,y2:0});var d=n("line",{parent:this.g,x1:this.scroll.position*c,x2:this.scroll.position*c,y1:-4,y2:4,"stroke-width":3});return this.scroll.on("update",function(){n(d,{x1:b.scroll.position*c,x2:b.scroll.position*c})}),this.stops=this.scroll.stops.map(function(a){return n("line",{parent:b.g,x1:a.position*c,x2:a.position*c,y1:-4,y2:4})}),this}}]),a}();return a.Stop=A,a.Interval=B,a.Scroll=D,a.ScrollHandler=F,a.ScrollSVG=I,a}({});
